<template>
  <div
    :id="`text-input-${id}`"
    :data-disabled="disabled"
    :data-required="required"
    :data-valid="valid"
    :data-error="error !== undefined"
    :data-title-is-heading="title_is_heading"
    class="group"
  >
    <div class="flex flex-row flex-nowrap w-full items-center mb-1">
      <div class="w-5/6">
        <label :for="id">
          <span 
            class="
            block
            mb-1
            
            group-data-[title-is-heading='true']:text-heading-base
            group-data-[title-is-heading='true']:font-semibold
            
            group-data-[required='true']:after:content-['*']
            group-data-[required='true']:after:text-[0.9em]
            group-data-[required='true']:after:text-red-500
            group-data-[required='true']:after:font-bold
            group-data-[required='true']:after:ml-1
            
            group-data-[valid='true']:text-green-800
            group-data-[error='true']:text-red-500
            "
          >
            {{ label }}
          </span>
          <slot name="description"></slot>
        </label>
      </div>
      <div
        class="
          w-1/6
          flex
          place-content-end
          pr-1
          group-data-[error='true']:text-red-500 
          group-data-[valid='true']:text-green-800
          group-data-[disabled='true']:text-gray-600/50
        "
      >
        <InputStateIcon
          :valid="valid"
          :error="error !== undefined"
          :disabled="disabled"
        />
      </div>
    </div>
    <div 
      class="
        flex
        items-center
        mt-2
        p-1
        border
        rounded-md
        focus-within:border-gray-600
        group-data-[valid='true']:border-green-800
        group-data-[error='true']:border-red-500
        group-data-[disabled='true']:bg-gray-200/50
      "
    >
      <MagnifyingGlassIcon 
        v-if="type === 'search'"
        class="m-1 w-[1.25rem] h-[1.25rem] text-gray-600"
      />
      <input
        :id="id"
        :type="type"
        :value="value"
        :placeholder="placeholder"
        :required="required"
        :aria-required="required"
        :disabled="disabled"
        class="
          w-full
          py-1
          pl-4
          pr-1
          bg-transparent
          focus:outline-none
          group-data-[disabled='true']:text-gray-600/80
        "
      />
    </div>      
    <div v-if="error" class="w-full pt-1">
      <p class="text-red-500">{{ error }}</p>
    </div>
  </div>
</template>

<script setup lang="ts">
import InputStateIcon from "../icons/InputStateIcon.vue";
import { MagnifyingGlassIcon } from "@heroicons/vue/24/solid";

interface Props {
  id: string,
  type?: 'date' | 'datetime-local' | 'email' | 'number' | 'password' | 'search' | 'tel' | 'text' | 'time' | 'url';
  label: string;
  value?: string,
  placeholder?: string;
  disabled?: boolean;
  required?: boolean;
  valid?: boolean,
  error?: string;
  title_is_heading?: boolean,
}

withDefaults(defineProps<Props>(), {
  type: "text",
  disabled: false,
  required: false,
  valid: false
});

</script>