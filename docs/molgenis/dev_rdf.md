# RDF

The Resource Description Format (RDF) is the W3C standard for web data.
MOLGENIS EMX2 can export data in this format by using the RDF API.
For server-wide API calls, it is located at `<server>/api/rdf` where `<server>` is the location where your MOLGENIS is hosted.
Additionally, each database has an API available at `<server>/<database>/api/rdf`.
For instance, if your MOLGENIS runs at `https://emx2.test.molgenis.org` and it has a database called `example`, the RDF API location for this database is `https://emx2.test.molgenis.org/example/api/rdf`.


## configuration

The RDF API can be fine-tuned on a schema-based level by adding advanced settings.
If combining multiple schemas having overlapping/conflicting data, this will be processed in a way that will result in a valid RDF output (details are described below for each advanced setting individually).

To learn more about how to configure the output on a column-specific level, see the documentation regarding the [semantics field](./semantics.md).

### Generic triples

Advanced setting key: `custom_rdf`

Define triples that should be added to each API call for this schema.
Preferably should only be used for defining some global information such as the license of the data retrieved through the API calls.

**The value of this advanced setting requires valid Turtle-formatted RDF!**
Any namespaces defined here <ins>will not</ins> be included in the RDF generated by the API.

When combining multiple namespaces, the `custom_rdf` from these will simply be combined.
Therefore, it is suggested to base the used subject on the database URL. 

### Custom semantic prefixes

Advanced setting key: `semantic_prefixes`

Overrides the default namespaces [as defined here](./semantics.md#formatting).
Requires a csv-like format where each line represents a single namespace and each line has 2 values, namely the prefix and the namespace IRI:
```csv
dcat,http://www.w3.org/ns/dcat#
dcterms,http://purl.org/dc/terms/
```

!> The following prefixes are **not** allowed: `http`, `https`, `urn` & `tag`

!> When the default is overridden, make sure to either include previously used namespaces or adjust every semantic field that uses a prefix that is not supported anymore.

Conflicts in namespaces will not break the RDF output but might result in unexpected behaviour. Examples include:
* If 2 different namespaces use the same prefix, only one of them will use that prefix while the other simply returns full IRIs in the API output.
* If 2 identical namespaces exist with a different prefix, only one of the prefixes will be used for all IRIs belonging to that namespace.

## data retrieval
RDF API retrieve data in different scopes ranging from broad (retrieve everything) to narrow (retrieve one row).
All data is exported as a stream, which means that the response does not include a size estimate.
Listed below are the available options.

### Retrieve everything / multiple schemas
Using `<server>/api/rdf`, all data from this MOLGENIS instance is retrieved and exported as RDF.
Optionally use 'schemas' parameter to filter what schemas to be included. E.g. `<server>/api/rdf?schemas=foo,bar` will only retrieve from schemas 'foo' and 'bar'
Of course, this is limited to data to which the currently logged-in user (or anonymous user) has access to.

### Retrieve one schema
By including a database schema name in the URL, data from one particular schema is retrieved and exported as RDF.
The schema name is added between the server location and RDF API location: `<server>/<schema>/api/rdf`.
For example: `<server>/pet%20store/api/rdf`.

### Retrieve one table
One particular table from a schema can be retrieved by adding a table name to a URL that also contains schema name: `<server>/<schema>/api/rdf/<table>`.
For example: `<server>/pet%20store/api/rdf/Pet`

### Retrieve one column
One particular column from a table within a schema can be retrieved by adding a column name to a URL that also contains schema and table name: `<server>/<schema>/api/rdf/<table>/column/<column-name>`.
For example: `<server>/pet%20store/api/rdf/Pet/column/name`

### Filter rows
The rows from a table within a schema can be filtered based on a column value by adding these as a `key=value` pair to a URL that also contains schema and table name: `<server>/<schema>/api/rdf/<table>?<column-name>=<value>`.
For example: `<server>/pet%20store/api/rdf/Pet?category=cat`

## data formats
Using the content negotiation, RDF can be exported in one of many available formats. For example the following curl command will download the pet store in jsonld:

`curl -H 'Accept: application/ld+json' <server>/pet%20store/api/rdf`

The default format is Turtle, but by passing one of the following mime types in the `Accept:` header you can select a different format.

The recognized mime types are:
- `text/turtle` (Turtle, Terse RDF Triple Language, https://www.w3.org/TR/turtle/)
- `text/n3` (Notation 3, https://www.w3.org/TeamSubmission/n3/)
- `application/n-quads` (N-Quads, https://www.w3.org/TR/n-quads/)
- `application/n-triples` (N-Triples, https://www.w3.org/TR/n-triples/)
- `application/trig` (TriG, https://www.w3.org/TR/trig/)
- `application/rdf+xml` (RDF/XML, https://www.w3.org/TR/rdf-syntax-grammar/)
- `application/ld+json` (JSON-based Serialization for Linked Data, https://www.w3.org/TR/json-ld11/)

### Convenience APIs
As a convience there are APIs to always download in Turtle or JSON-LD:
- `/api/ttl` Downloads always in Turtle
- `/api/jsonld` Downloads always in JSON-LD

One can replace `/api/rdf/` with the above convenience APIs in any of the explained data retrieval API points as
mentioned on this page (such as `<server>/pet%20store/api/jsonld/Pet?category=cat`).