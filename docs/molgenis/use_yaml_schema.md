# ðŸ§¬ MOLGENIS YAML modeling language â€” User Documentation

**MOLGENIS YAML modeling language 1.0** is a modular YAML-based metadata schema language used to define data models for the MOLGENIS
platform. With EMX2 generation3.0,
we introduce enhanced features for UI generation, modular reuse, semantic annotation, versioning, and rich web/data interfaces.

---

## ðŸš€ Key Features

- One YAML file defines all: **Web forms**, **CSV/Excel format **, **REST**, **GraphQL**, **RDF**, **LDP**
- Native support for **modular composition**, **ontologies**, **polymorphism**, and **computed logic**
- Support for **authoring**, **licensing**, **data typing**, **validation**, and **dynamic UI behavior**
- Rich semantics on class and instance level

---

## ðŸ”– Simple example

A simple example below:

```yaml
schema: pet store
description: my pet store
entities:
  - entity: Pets
    description: the table with the pets
    fields:
    - field: name
      label: Unique name
      key: 1
      # key1 is implicitly also required: true
    - field: status
      # enum implies type=enum
      enum: [available,unavailable]
      required: true
    - field: species
      # ontology file, implies type=ontology
      ontology: ../species.csv
    - name: weight
      type: int
  - entity: Orders
    field:
    - field: order id
      description: auto generated identifier
      default: snowflake()
      readonly: true
    - field: pet
      # multiselect is a lookup type, translates to foreign key
      multiselect: Pets
      required: true
    - field: date delivered
      type: date
      # n.b. field id will be autogenerated as camelCase from name
      validIf: dateDelivered < today()
    - field: customer
      select: Customer
      # todo? can filter the 'select' lookup
      # lookupFilter: {status: {equals:'active'}}
  - entity: Customer
    fields:
    - field: customer id
      key: 1

```

---

## Schema modeling

Below a synthetic schema example showing all schema properties:

```yaml
schema: some name
description: this is an example schema
prefixes:
# see section on Semantics modeling
settings:
# see section on Settings modeling
entities:
# see section on Entity modeling

```

Definition of the properties

| Schema property | Usage                                                                                                                                                       |
|-----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| entities        | listing of the entities in this schema                                                                                                                      |
| name            | name of the schema. Is only used when including this schema into a schema registry, because in practice each schema instance will have their own local name |
| description     | (optional) human readable description                                                                                                                       |
| prefixes        | (optional) used for semantics. See section on Semantics.                                                                                                    |
| settings        | (optional) used for settings. See section on Settings                                                                                                       |

---

## Entity modeling

Entities could be tables, classes, etc, depending on your system.
Below a synthetic schema example showing all entity properties:

```yaml
entity: mytab
label: My table
description: A entity description
settings:
# see Settings modeling
semantics:
# see Semantic modeling
variants:
# see Variant modeling
fields:
# see Field modeling
```

A entity can have the following properties:

| Property   | Usage                                                                                                                                                                                                                                                                       |
|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| entity     | Entity name must be unique within a schema. Name must start with a letter, followed by zero or more letters, numbers, spaces or underscores. A space immediately before or after an underscore is not allowed. The character limit is 31 (so it fits in Excel sheet names). |
| label      | (optional) user friendly label. Generally we recommend against labels because it leads to confusion                                                                                                                                                                         | |
| semantics  | (optional) semantic definition for this entity. See section on Semantics                                                                                                                                                                                                    |
| variants   | (optional) definition of subtypes for this entity. See section on Polymorphism                                                                                                                                                                                              |
| settings   | (optional) definition of settings for this entity. See section on Settings                                                                                                                                                                                                  |
| version    | (optional) indicate version number. Overrides schema version number if exists                                                                                                                                                                                               |

### Entity variants

There are some use cases where entities ideally can be used in different subtypes. In object oriented modeling this is known as inheritance.
This is useful to allow for different views, to allow foreign key checks to only go to rows of a specific type.

variants can be defined as follows:

```yaml
entity: Catalogued resources
variants:
# variant names must be unique within the schema
- variant: Datasets
  # the active variant for a row can be depending on a field value
  # otherwise mg_variant will be used, set by the user. 
  # a row can be of multiple types
  when: type === 'Dataset'
- variant: Catalogues
  when: type === 'Catalogue'
- variant: Dataset serices
  # (multiple) inheritance is possible, except for the primary key
  extends: [Dataset]
fields:
- field: id
  key: 1
  # primary key cannot have a variant
- field: type
  type: ontology
  # in this case we use an ontology to choose between variants
  ref: Catalogue resource types
- field: part of catalogue
  type: select
  ref: Catalogues
  # this relation is only shown in Datasets
  variant: Datasets
- field: datasets
  type: subtable
  ref: TODO
  variant: Catalogue


```

---

## Field modeling

An artificial example showing many field options, except semantics and predicates (see section on semantics/precidates):

```yaml
entity: My table
variants:
- name: subtype
fields:
- field: f1
  label: field one
  description: some description
  # indicate that field is unique
  key: 1
  type: select
  # if type is a lookup then lookupTable is required
  ref: some table
  refLabel: ${name}
  # filtering using some graphql filter expression
  visibleIf: otherfield > 0
  readonly: true
- field: f2
  label: other field
  type: int
  validIf: f2 > 0
  default: 2
  examples: [1,2,3]
  variant: subtype
- name: f3
  computed: f2*2
  #  not shown in user interface
  hidden: true
```

Field can have the following properties

| property    | Usage                                                                                                                                                                                                                                            |
|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| field       | (required) name unique within the containing entity                                                                                              <br/>                                                                                           |
| label       | (optional) human readable label. Unique within the containing entity. Cannot conflict with other names.                                                                                                                                          |
| key         | (optional) to indicate what key a field is part of. Should be numbers. key: 1 is a special case denoting primary key of the entity, which is then used for lookups                                                                               |
| type        | (optional) value type, default 'string'. We support primive types: string, int, bigint, decimal, long, date, datetime, bool, text, hyperlink, period, <br/><br/>uuid, file, email, json, autoid, and lookup types: select, radio, ontology, .... |
| description | (optional) human readable description                                                                                                                                                                                                            |
| visibleIf   | (optional) javascript expression if the field is visible                                                                                                                                                                                         |
| validIf     | (optional) javascript expression if the field value is valid                                                                                                                                                                                     |
| readonly    | (optional) indicate that a field cannot be edited after insertion                                                                                                                                                                                |
| hidden      | (optional) indicate that a field is hidden in the user interface                                                                                                                                                                                 |
| computed    | (optional) is a javascript expression to calculate value of this field. Field will not be editable                                                                                                                                               |
| default     | (optional) provide a default value                                                                                                                                                                                                               |
| variant     | (optional) in what variants of the entity this field should be visible. See section on Polymorphism                                                                                                                                              |
| predicates  | (optional) allows generation of rdf instances from this field. See section on Semantics & Predicates                                                                                                                                             |
| migrations  | (optional) allows definition of data migrations between versions                                                                                                                                                                                 |
| version     | (optional) allows version numbering of the field. If not provided the version of entity or schema is used                                                                                                                                        |
| comment     | (optional) allow to add comments not shown elsewhere                                                                                                                                                                                             |
| examples    | (optional) some example values                                                                                                                                                                                                                   |

N.B. general metadata can be applied such as 'authors'

N.B. also lookup types can be valid properties, i.e. select, select_many, radio, checkbox, enum, ontology, ontology_many.

### ðŸ”— Lookups and Relations

Relations can be defined as follows

```yaml
- name: my field
  type: <some lookup type>
  ref: Table names
```


The following lookup types are available:

| Ref type        | Usage                                       |
|-----------------|---------------------------------------------|
| `radio`         | Select one (rendered as radio buttons)      |
| `select`        | Select one (dropdown)                       |
| `checkbox`      | Select many (rendered as checkboxes)        |
| `select_many`   | Select many (dropdown)                      |
| `ontology`      | Select one from ontology (radio + tree)     |
| `ontology_many` | Select many from ontology (checkbox + tree) |
| `subtable`      | Inline nested table                         |

The following additional options are available for lookup types:

| Lookup option | Usage                                                                                                                                                                     |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ref           | in case of a lookup type this denotes the entity linked to. |      
| refLabel      | in case of a lookup you can use a javascript string expression to calculate label. E.g. '${field1} ${field2}'                                                           

### Primary key and unique constraints

todo

### Validation expressions (validIf)

todo

### Visible expressions (visibleIf)

todo

### Default value expressions (default)

Using â€˜defaultValueâ€™ you can set a default value for a field. In forms, this value will be pre-filled. When uploading csv/excel all empty cells will receive
the defaultValue (in insert and update) Optionally you can also use javascript expressions. For example:

* duck would set a string value
* 1 would set a numeric value
* =new Date().toISOString() provides automatic date/dateTime
* ={name:"green"} could be default value for an ontology_
* =[{name:"green"}] could be default value for an ontology_array

* Known limitation: doesnâ€™t work for fields refering to a entity with composite primary key (i.e. having multiple key=1 fields).

---

## Heading modeling

In larger entities schema designers will want to split the form in parts, expecting in the user interface to have these as headings, and expecting that
visibleIf relations apply on the whole heading. Within API the headings are opaque and only the fields inside are available.

headings can be defined as follows:

```yaml
  name: My table
  fields:
  # name is required for a heading and should be unique within a entity and cannot be duplicate to any field name
  - heading: name
    description: Fill in your name
  # see Field modeling
  - field: first name
    key: 1
  - field: last name
    key: 1
  - heading: contact information
    # heading can be conditional, and so its contents too
    visibleIf: firstName
  - field: street
  - field: city
```

## Semantic modeling

MOLGENIS yaml has rich options for semantic annotation, and to provide specification on how rdf conversion of data in its schemas should be implemented.

A synthetic example:

```yaml
  schema: My schema
  prefixes:
    # default prefixes might apply, at least 'rdf'
    foaf: http://xmlns.com/foaf/spec/#
    dct: http://purl.org/dc/terms/
  entities:
  - entity: Agent
    semantics:
      rdf:type foaf:Agent
    variants:
    - variant: Person
      semantics:
        rdf:type foaf:Person
        # note you don't need to use CURIE
        skos:broader http://purl.bioontology.org/ontology/SNOMEDCT/125676002
    - variant: Organisation
      semantics:
        rdf:type foaf:Organization
    fields:
    - field: id
      predicates: [dct:identifier]
    - field: first name
      pkey: 2
      predicates: [foaf:firstName]
      variant: Person
    - field: last name
      pkey: 2
      predicates: [foaf:lastName]
      variant: Person


```

Properties for semantic annotation:

| Semantics property | Usage                                                                                                                         |
|--------------------|-------------------------------------------------------------------------------------------------------------------------------|
| prefixes           | a map of prefix, iri which can be used for CURIE in semantics and predicates. Can be defined on schema, entity, field levels. |
| semantics          | any semantic statements on entity or field level                                                                              |
| predicates         | on field level, use predicates to influence how (rowid)(predicate)(field value) triples will be generated in rdf              |

todo, generate an example of the rdf output

---

## ðŸ§¬ Modeling polymorphism such as 'inheritance'

Variants allow defining different "views" or "profiles" of your entity depending on a `visibleIf:` condition. Each variant:

- Always includes `key1` fields
- Can `extend:` other variants
- May define its own `semantics:` (e.g., `rdf:type`)

```yaml
  entity: Catalogued resource
  variants:
  - variant: health data source
  - variant: registry
    visibleIf: type === 'Registry'
  - variant: cohort
    visibleIf: type === 'Cohort'
    # so includes all fields from registry
    extends: [health data source]
  fields:
  - field: id
    key: 1
  - field: health theme
    variant: health data source
  - field: registry type
    type: ontology
    ref: Registry types
    variant: registry
  - name: cohort types
    type: ontology
    ref: Cohort types
    variant: cohort
```

---

## Settings

Settings can be defined, using an extension of the 'field' schema that includes 'value'.
Settings can be defined on schema, entity or field level.

```yaml
  schema: My schema
  settings:
  - setting: some boolean setting on my schema
    type: bool
    value: true
  - setting: some int setting
    type: int
    validIf: someIntSetting > 0
  entities:
  - entity: Person
    settings:
    - setting: table type
      ontology: Table types
```

---

## Internationalization (i18n)

todo. can have i18n using 'labels' and 'descriptions'

```yaml
  entity: mytab
  # we can hava i18n like this, instead of 'label' and 'description'
  labels:
    en: my table
    nl: mijn tabel
  descriptions:
    en: my table descriptoin
    nl: beschrijving van de tabel in nederlands

```

## ðŸ”§ Provenance information

If necessary MOLGENIS yaml allows to add provance information.
This is available on `schema`, `entity`, and `field`.

example:

  ```yaml
schema:
  authors:
  - name: K. Joeri van der Velde
    email: k.j.van.der.velde@umcg.nl
    orcid: 0000-0002-0934-8375
  - name: Morris A. Swertz
    email: m.a.swertz@umcg.nl
    orcid: 0000-0002-0979-3401
  copyright:
    holder: University Medical Center Groningen
    years: 2019-2021
  license:
    # when licence in https://spdx.github.io/spdx-spec/v2.3/SPDX-license-list/ we don't need URL
    name: Attribution 4.0 International (CC BY 4.0)
    url: https://creativecommons.org/licenses/by/4.0/
```

| Property      | Description                                           |
|---------------|-------------------------------------------------------|
| `name`        | Required, unique identifier                           |
| `label`       | Human-readable label (supports i18n e.g. `label:nl:`) |
| `description` | Human-readable description                            |
| `semantics`   | Ontology mappings (IRI/curie â†’ label from vocab)      |
| `prefixes`    | CURIE definitions for use in semantics/imports        |
| `authors`     | List of authors with name, email, ORCID               |
| `license`     | SPDX license name and URL                             |
| `copyright`   | Owner and year                                        |
| `units`       | Path to unit ontology                                 |

---


## MOLGENIS YAML file composition

todo describe, see examples for now

```yaml
# identifiable.yaml
  entity: Identifiable
  fields:
  - field: id
    key: 1

---
#person.yaml
  entity: Person
  fields:
  # get the fields from Identifiable
  - imports: identifiable.yaml
  - field: name
    key: 2
  - field: bogus

---
# this file composes from the imports
  schema: bla
  entities:
  - imports: [person.yaml]
  - imports: [organisation.yaml]

```

---

Appendix: yaml schema of the MOLGENIS yaml schema

todo.

