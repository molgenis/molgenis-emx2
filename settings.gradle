/*
 * This file was generated by the Gradle 'init' task.
 */
plugins {
    id "com.mooltiverse.oss.nyx" version "2.4.4-hotfix219.3"
}

nyx {
    verbosity = "INFO"
    preset = "simple"
    releasePrefix = "v"
    releaseTypes {
        items {
            mainline {
                matchBranches = "master"
                publish = "true"
                description = "{{#fileContent}}CHANGELOG.md{{/fileContent}}"
                publicationServices = ["github"]
            }
            internal {
                collapseVersions = true
                collapsedVersionQualifier = 'SNAPSHOT'
                identifiers {}
            }
        }
    }
    services {
        github {
            type = "GITHUB"
            options {
                AUTHENTICATION_TOKEN = "{{#environmentVariable}}GITHUB_TOKEN{{/environmentVariable}}"
                REPOSITORY_OWNER = "molgenis"
                REPOSITORY_NAME = "molgenis-emx2"
            }
        }
    }
    releaseAssets {
        jar {
            path = "build/libs/molgenis-emx2-{{#replace from=\"v\"}}{{version}}{{/replace}}-all.jar"
            fileName = "molgenis-emx2-{{#replace from=\"v\"}}{{version}}{{/replace}}-all.jar"
            type = "application/java-archive"
        }
    }
    changelog {
        path = "CHANGELOG.md"
	template = "changelog-notes.tpl"
        sections = [
                'Added' : '^feat$',
                'Fixed' : '^fix$',
        ]
    }
    commitMessageConventions {
        enabled = [ 'conventionalCommits' ]
        items {
            conventionalCommits {
                expression = '(?m)^(?<type>[a-zA-Z0-9_]+)(!)?(\\\\((?<scope>[a-z ]+)\\\\))?:( (?<title>.+))$(?s).*'
                bumpExpressions {
                    major = '(?s)(?m)^[a-zA-Z0-9_]+(!|.*^(BREAKING( |-)CHANGE: )).*'
                    minor = '(?s)(?m)^feat(?!!|.*^(BREAKING( |-)CHANGE: )).*'
                    patch = '(?s)(?m)^fix(?!!|.*^(BREAKING( |-)CHANGE: )).*'
                }
            }
        }
    }
}

rootProject.name = 'emx2'
include(':apps')
include(':apps:central')
include(':apps:catalogue')
include(':apps:settings')
include(':apps:schema')
include(':apps:updownload')
include(':apps:tables')
include(':apps:pages')
include(':apps:graphql-playground')
include(':apps:nuxt3-ssr')
include(':apps:helloworld')
include(':apps:molgenis-components')
include(':apps:reports')
include(':apps:tasks')
include(':docs')
include(':backend:molgenis-emx2')
include(':backend:molgenis-emx2-datamodels')
include(':backend:molgenis-emx2-io')
include(':backend:molgenis-emx2-sql')
include(':backend:molgenis-emx2-sql-it')
include(':backend:molgenis-emx2-webapi')
include(':backend:molgenis-emx2-graphql')
include(':backend:molgenis-emx2-run')
include(':backend:molgenis-emx2-tasks')
include(':backend:molgenis-emx2-semantics')
include('backend:molgenis-emx2-email')
include(':tools:pyclient')


